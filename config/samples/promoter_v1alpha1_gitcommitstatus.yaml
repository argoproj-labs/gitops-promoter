apiVersion: promoter.argoproj.io/v1alpha1
kind: GitCommitStatus
metadata:
  name: gitcommitstatus
spec:
  promotionStrategyRef:
    name: promotion-strategy-sample
  name: revert-check
  description: "Revert commit validation"
  # This expression returns false if EITHER condition is true:
  # 1. Commit message matches the "^Revert" pattern → fail
  # 2. Commit has a "Git-commit-status: pending" trailer → fail
  # The validation passes only if NEITHER condition is true
  # Note: 'matches' is an infix operator, and 'in' is used to check map key existence
  expression: '!(Commit.Message matches "^Revert" || ("Git-commit-status" in Commit.Trailers && Commit.Trailers["Git-commit-status"][0] == "pending"))'
