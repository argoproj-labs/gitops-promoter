FROM golang:1.25

WORKDIR /

RUN apt-get update && apt-get install -y tini && apt-get clean && rm -rf /var/lib/apt/lists/*

RUN mkdir -p /git

COPY ./bin/gitops-promoter /gitops-promoter
COPY hack/git/promoter_askpass.sh /git/promoter_askpass.sh
COPY ui/web/static ./ui/web/static

ENV PATH="${PATH}:/git"
USER 65532:65532

ENTRYPOINT ["/usr/bin/tini", "--", "/gitops-promoter"]
